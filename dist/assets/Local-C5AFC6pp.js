import{f as L,r as s,h as P,j as t}from"./index-ftk_uoOV.js";import{N as E}from"./Newscard-j7L5Q26Y.js";import{L as b}from"./Loader-1BNeB-Jp.js";import{m as M,S as k}from"./Sponsers-DWANzkNw.js";const O=()=>{const{category:m}=L(e=>e.category),[c,f]=s.useState([]),[l,g]=s.useState(1),[h,p]=s.useState(!0),[x,v]=s.useState(!1),d=s.useRef(null),u=s.useRef(!1),[y,N]=s.useState("general");s.useEffect(()=>{m&&(N(m),g(1),f([]),p(!0),v(!1),u.current=!1,d.current&&(d.current.disconnect(),d.current=null))},[m]);const{data:i,isFetching:a,error:w}=P({page:l,limit:10,category:y},{skip:!y,keepPreviousData:!0,refetchOnMountOrArgChange:!1});return s.useEffect(()=>{i&&(u.current=!1,f(l===1?i.posts||[]:e=>{const o=(i.posts||[]).filter(r=>!e.some(n=>n._id===r._id));return[...e,...o]}),p((i==null?void 0:i.hasMore)??!1),v(!0))},[i,l]),s.useEffect(()=>{if(!x||!h||a)return;const e={root:null,rootMargin:"100px",threshold:1},o=S=>{const[I]=S;I.isIntersecting&&!u.current&&(u.current=!0,g(A=>A+1))},r=new IntersectionObserver(o,e);d.current=r;const n=document.querySelectorAll(".post-item"),j=n[n.length-1];return j&&r.observe(j),()=>r.disconnect()},[c,h,a,x]),w?t.jsx("div",{className:"bg-gray-600 min-h-screen flex items-center justify-center",children:t.jsx("div",{className:"text-white text-xl",children:"Error loading posts. Please try again."})}):!x&&a?t.jsx("div",{className:"bg-gray-600 min-h-screen flex items-center justify-center",children:t.jsx(b,{})}):t.jsxs(M.div,{layoutId:"underline",className:"bg-gray-600 min-h-screen pb-16",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[t.jsx("div",{className:"pt-4 sm:m-4",children:t.jsx(k,{})}),t.jsxs("div",{className:"posts-container",children:[c.length>0?t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 p-4 mt-4",children:c.map((e,o)=>{var r,n;return t.jsx("div",{className:"post-item bg-gray-200 rounded-2xl overflow-hidden shadow-lg hover:shadow-xl transition-shadow duration-300",children:t.jsx(E,{title:e.title,postId:e._id,link:`/viewfull/${e._id}`,description:e.description?`${e.description.slice(0,88)}...`:"No description available",pubDate:new Date(e.createdAt).toLocaleDateString(),sourceId:"DehatiNews",creator:e.creator||"Ajay Sharma",imageUrl:(n=(r=e.photos)==null?void 0:r[0])==null?void 0:n.url})},`${e._id}-${o}`)})}):!a&&t.jsx("div",{className:"text-white text-center text-xl mt-10",children:"No Posts Available"}),a&&l>1&&t.jsx("div",{className:"flex justify-center my-8",children:t.jsx(b,{})}),h&&!a&&c.length>0&&t.jsx("div",{className:"flex justify-center my-8",children:t.jsx("button",{onClick:()=>g(e=>e+1),className:"bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-6 rounded-full transition-colors duration-200",children:"Load More"})})]})]})};export{O as default};
